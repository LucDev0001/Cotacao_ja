<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cota√ß√£oJ√° - Sistema de Compras</title>

    <!-- Scripts e Estilos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <meta name="theme-color" content="#1e3a8a" />

    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .fade-enter {
        animation: fadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1);
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Estilo para as Notifica√ß√µes de Atividade em Tempo Real */
      #activity-feed-container {
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        gap: 10px;
        pointer-events: none; /* Permite clicar atrav√©s do container */
      }
      .activity-toast {
        display: flex;
        align-items: center;
        gap: 12px;
        background-color: rgba(30, 41, 59, 0.9);
        backdrop-filter: blur(8px);
        color: white;
        padding: 12px 16px;
        border-radius: 12px;
        box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.2),
          0 4px 6px -4px rgb(0 0 0 / 0.2);
        animation: slideInUp 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards,
          fadeOut 0.5s 4.5s forwards;
        pointer-events: all; /* Permite intera√ß√£o com o toast se necess√°rio */
      }
      @keyframes slideInUp {
        from {
          transform: translateY(30px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
          transform: translateY(-10px);
        }
      }
    </style>
  </head>
  <body class="bg-slate-50 text-slate-800 flex flex-col min-h-screen">
    <!-- ======================================================= -->
    <!-- 1. LANDING PAGE (Visitantes) -->
    <!-- ======================================================= -->
    <div id="landing-screen" class="flex-grow flex flex-col fade-enter">
      <!-- Container para o Feed de Atividades em Tempo Real -->
      <div id="activity-feed-container"></div>

      <nav
        class="container mx-auto px-6 py-5 flex justify-between items-center relative z-10"
      >
        <div
          class="font-bold text-2xl text-blue-900 tracking-tighter flex items-center gap-2"
        >
          <div class="bg-blue-600 text-white p-1.5 rounded-lg">
            <i data-lucide="layers" class="w-5 h-5"></i>
          </div>
          Cota√ß√£o<span class="text-blue-500">J√°</span>
        </div>
        <div class="flex items-center gap-4">
          <a
            href="faq.html"
            class="text-slate-500 hover:text-blue-600 text-sm font-medium hidden sm:block transition"
            >Como funciona?</a
          >
          <button
            id="btn-install-app"
            class="hidden bg-blue-600 text-white font-bold hover:bg-blue-700 transition text-sm px-6 py-2.5 rounded-full shadow-md shadow-blue-500/20 flex items-center gap-2"
          >
            <i data-lucide="download" class="w-4 h-4"></i> Instalar App
          </button>
          <button
            onclick="mostrarLogin()"
            class="bg-white text-blue-900 font-bold hover:bg-blue-50 transition text-sm border border-blue-200 px-6 py-2.5 rounded-full shadow-sm"
          >
            Entrar
          </button>
        </div>
      </nav>

      <header
        class="flex-1 container mx-auto px-6 flex flex-col md:flex-row items-center justify-center gap-16 py-12 relative z-0"
      >
        <!-- Background Blob Decorativo -->
        <div
          class="absolute top-0 right-0 -z-10 w-[600px] h-[600px] bg-blue-100 rounded-full blur-3xl opacity-50 translate-x-1/3 -translate-y-1/4"
        ></div>

        <div class="md:w-1/2 space-y-8 text-center md:text-left">
          <span
            class="bg-blue-50 text-blue-700 text-xs font-bold px-4 py-1.5 rounded-full uppercase tracking-wide border border-blue-100"
            >üöÄ B2B Inteligente</span
          >
          <h1
            class="text-5xl md:text-7xl font-extrabold leading-tight text-slate-900 tracking-tight"
          >
            Compre melhor.<br />
            <span
              class="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600"
              >Venda mais r√°pido.</span
            >
          </h1>
          <p class="text-lg text-slate-600 md:max-w-md leading-relaxed">
            A plataforma que conecta gerentes de loja a fornecedores em tempo
            real. Cota√ß√£o simples, direta e sem intermedi√°rios.
          </p>
          <div
            class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start pt-2"
          >
            <button
              onclick="mostrarLogin()"
              class="bg-blue-600 text-white px-8 py-4 rounded-2xl font-bold text-lg shadow-xl shadow-blue-500/30 hover:bg-blue-700 transition transform hover:-translate-y-1 flex items-center justify-center gap-2"
            >
              Come√ßar Agora <i data-lucide="arrow-right" class="w-5 h-5"></i>
            </button>
          </div>
        </div>

        <!-- Ilustra√ß√£o 3D CSS -->
        <div class="md:w-1/2 flex justify-center relative perspective-1000">
          <div
            class="relative bg-white/80 backdrop-blur-sm p-6 rounded-3xl shadow-2xl border border-white/50 w-full max-w-sm transform rotate-y-12 rotate-x-6 hover:rotate-0 transition duration-700 ease-out"
          >
            <div
              class="flex justify-between items-center mb-6 border-b border-slate-100 pb-4"
            >
              <div class="flex items-center gap-3">
                <div
                  class="w-12 h-12 bg-orange-100 rounded-2xl flex items-center justify-center text-orange-600 shadow-sm"
                >
                  <i data-lucide="package" class="w-6 h-6"></i>
                </div>
                <div>
                  <div class="text-sm font-bold text-slate-800">
                    Pedido #4092
                  </div>
                  <div class="text-xs text-slate-400 font-medium">
                    Aguardando ofertas
                  </div>
                </div>
              </div>
              <div
                class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold"
              >
                Em aberto
              </div>
            </div>
            <div class="space-y-3">
              <div
                class="bg-white rounded-xl p-4 flex items-center justify-between shadow-sm border border-slate-100"
              >
                <div class="flex items-center gap-3">
                  <div
                    class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 text-xs font-bold"
                  >
                    F1
                  </div>
                  <span class="text-sm font-bold text-slate-600"
                    >Fornecedor A</span
                  >
                </div>
                <span class="text-sm font-bold text-slate-400">R$ 2.800</span>
              </div>
              <div
                class="bg-green-50 rounded-xl p-4 flex items-center justify-between border border-green-200 shadow-md transform scale-105"
              >
                <div class="flex items-center gap-3">
                  <div
                    class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center text-xs font-bold shadow"
                  >
                    F2
                  </div>
                  <span class="text-sm font-bold text-green-900"
                    >Fornecedor B</span
                  >
                </div>
                <span
                  class="text-sm font-bold text-green-700 bg-green-100 px-2 py-0.5 rounded"
                  >R$ 2.650</span
                >
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- Se√ß√£o de Depoimentos -->
      <section class="py-20 bg-white border-t border-slate-100">
        <div class="container mx-auto px-6">
          <div class="text-center mb-12">
            <h2 class="text-3xl font-bold text-slate-800 mb-3">
              Quem usa, aprova
            </h2>
            <p class="text-slate-500 max-w-xl mx-auto">
              Veja o que gerentes e fornecedores est√£o dizendo sobre a nossa
              plataforma.
            </p>
          </div>

          <!-- Carrossel -->
          <div
            id="depoimentos-carousel"
            class="flex gap-6 overflow-x-auto pb-8 no-scrollbar snap-x px-4"
          >
            <!-- Skeleton Loader Inicial -->
            <div
              class="min-w-[300px] md:min-w-[400px] bg-slate-50 p-8 rounded-3xl border border-slate-100 flex-shrink-0 animate-pulse"
            >
              <div class="h-4 bg-slate-200 rounded w-3/4 mb-4"></div>
              <div class="h-4 bg-slate-200 rounded w-1/2"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- NOVA SE√á√ÉO: COMO FUNCIONA -->
      <section class="py-20 bg-slate-100/70">
        <div class="container mx-auto px-6">
          <div class="text-center mb-12">
            <h2 class="text-3xl font-bold text-slate-800 mb-3">
              Simples, R√°pido e Gratuito
            </h2>
            <p class="text-slate-500 max-w-2xl mx-auto">
              Conectamos quem precisa comprar com quem quer vender, sem
              complica√ß√£o. Veja como √© f√°cil.
            </p>
          </div>

          <div class="grid md:grid-cols-2 gap-10 items-start">
            <!-- Coluna Gerentes -->
            <div class="space-y-6">
              <h3
                class="font-bold text-xl text-blue-800 flex items-center gap-3"
              >
                <i
                  data-lucide="shopping-bag"
                  class="w-8 h-8 bg-blue-100 text-blue-600 p-1.5 rounded-lg"
                ></i>
                Para Gerentes (Compradores)
              </h3>
              <div class="flex gap-4">
                <div class="font-bold text-4xl text-blue-200">1</div>
                <div>
                  <h4 class="font-bold text-slate-800">Publique seu Pedido</h4>
                  <p class="text-sm text-slate-500">
                    Precisa de um produto? Descreva o que busca e publique em
                    segundos.
                  </p>
                </div>
              </div>
              <div class="flex gap-4">
                <div class="font-bold text-4xl text-blue-200">2</div>
                <div>
                  <h4 class="font-bold text-slate-800">Receba Ofertas</h4>
                  <p class="text-sm text-slate-500">
                    Fornecedores enviam seus melhores pre√ßos diretamente para
                    voc√™.
                  </p>
                </div>
              </div>
              <div class="flex gap-4">
                <div class="font-bold text-4xl text-blue-200">3</div>
                <div>
                  <h4 class="font-bold text-slate-800">Feche Neg√≥cio</h4>
                  <p class="text-sm text-slate-500">
                    Gostou de uma oferta? Chame o fornecedor no WhatsApp com um
                    clique.
                  </p>
                </div>
              </div>
            </div>
            <!-- Coluna Fornecedores (EM BREVE) -->
            <div
              class="bg-white p-8 rounded-2xl shadow-sm border border-slate-200 mt-10 md:mt-0"
            >
              <h3
                class="font-bold text-xl text-orange-800 flex items-center gap-3 mb-6"
              >
                <i
                  data-lucide="truck"
                  class="w-8 h-8 bg-orange-100 text-orange-600 p-1.5 rounded-lg"
                ></i
                >Para Fornecedores (Vendedores)
              </h3>
              <p class="text-slate-600">
                Receba pedidos de cota√ß√£o de lojas pr√≥ximas a voc√™, envie sua
                melhor oferta e aumente suas vendas.
                <strong class="text-slate-800">Zero custo para come√ßar.</strong>
              </p>
            </div>
          </div>
        </div>
      </section>

      <footer
        class="bg-slate-50 border-t border-slate-200 py-10 text-center text-sm text-slate-500"
      >
        <div class="flex justify-center gap-6 mb-4 font-medium">
          <a href="termos.html" class="hover:text-blue-600 transition"
            >Termos</a
          >
          <a href="politica.html" class="hover:text-blue-600 transition"
            >Privacidade</a
          >
          <a href="faq.html" class="hover:text-blue-600 transition">Ajuda</a>
        </div>
        <p>
          &copy; 2025 Cota√ß√£oJ√°. Feito com üíô por
          <a href="#" class="font-bold text-slate-700 hover:underline"
            >SantosCodes</a
          >.
        </p>
      </footer>
    </div>

    <!-- ======================================================= -->
    <!-- 2. TELA DE LOGIN / CADASTRO (MODERNIZADA) -->
    <!-- ======================================================= -->
    <div
      id="auth-screen"
      class="hidden fixed inset-0 z-50 overflow-y-auto auth-bg flex items-center justify-center p-4 fade-enter"
    >
      <!-- Bot√£o Voltar Flutuante -->
      <button
        onclick="voltarInicio()"
        class="absolute top-6 left-6 text-white/80 hover:text-white transition flex items-center gap-2 font-medium z-10"
      >
        <i data-lucide="arrow-left" class="w-5 h-5"></i> Voltar
      </button>

      <div
        class="glass-panel w-full max-w-md p-8 rounded-3xl relative overflow-hidden"
      >
        <!-- Decorative circle -->
        <div
          class="absolute -top-20 -right-20 w-40 h-40 bg-blue-500/10 rounded-full blur-2xl"
        ></div>

        <div class="text-center mb-8 relative">
          <div
            class="w-16 h-16 bg-gradient-to-tr from-blue-600 to-indigo-600 rounded-2xl mx-auto flex items-center justify-center text-white mb-4 shadow-lg shadow-blue-500/30 transform rotate-3"
          >
            <i data-lucide="user-circle-2" class="w-8 h-8"></i>
          </div>
          <h2 class="text-3xl font-bold text-slate-800 tracking-tight">
            Bem-vindo
          </h2>
          <p class="text-slate-500 mt-2 text-sm">
            Acesse sua conta para continuar
          </p>
        </div>

        <div class="space-y-5 relative">
          <!-- Login Fields -->
          <div class="space-y-4 animate-fade-in">
            <div class="group">
              <div
                class="relative transition-all duration-300 focus-within:scale-[1.02]"
              >
                <i
                  data-lucide="mail"
                  class="absolute left-4 top-3.5 text-slate-400 w-5 h-5 group-focus-within:text-blue-500 transition-colors"
                ></i>
                <input
                  type="email"
                  id="email"
                  placeholder="E-mail"
                  class="w-full pl-12 p-3.5 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition font-medium text-slate-700 placeholder:text-slate-400"
                />
              </div>
            </div>
            <div class="group">
              <div
                class="relative transition-all duration-300 focus-within:scale-[1.02]"
              >
                <i
                  data-lucide="lock"
                  class="absolute left-4 top-3.5 text-slate-400 w-5 h-5 group-focus-within:text-blue-500 transition-colors"
                ></i>
                <input
                  type="password"
                  id="password"
                  placeholder="Senha"
                  class="w-full pl-12 p-3.5 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition font-medium text-slate-700 placeholder:text-slate-400"
                />
              </div>
            </div>
            <!-- Link Esqueci Senha -->
            <div id="forgot-password-link" class="text-right -mt-2">
              <button
                onclick="resetPassword()"
                class="text-xs font-bold text-blue-600 hover:underline transition"
              >
                Esqueci minha senha
              </button>
            </div>
          </div>

          <!-- Cadastro Fields (Hidden by default) -->
          <div
            id="signup-fields"
            class="hidden space-y-4 pt-2 border-t border-slate-100 fade-enter"
          >
            <div class="relative">
              <i
                data-lucide="user"
                class="absolute left-4 top-3.5 text-slate-400 w-5 h-5"
              ></i>
              <input
                type="text"
                id="nome"
                placeholder="Nome da Empresa ou Pessoa"
                class="w-full pl-12 p-3.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition"
              />
            </div>

            <div class="relative">
              <i
                data-lucide="phone"
                class="absolute left-4 top-3.5 text-slate-400 w-5 h-5"
              ></i>
              <input
                type="tel"
                id="whatsapp"
                placeholder="WhatsApp (DDD + N√∫mero)"
                class="w-full pl-12 p-3.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition"
              />
            </div>

            <!-- Toggle PF / PJ Moderno -->
            <div class="bg-slate-100 p-1 rounded-xl flex">
              <label class="flex-1 text-center cursor-pointer">
                <input
                  type="radio"
                  name="tipoPessoa"
                  value="pf"
                  checked
                  onchange="toggleDocInput()"
                  class="peer hidden"
                />
                <span
                  class="block py-2 rounded-lg text-sm font-bold text-slate-500 peer-checked:bg-white peer-checked:text-blue-600 peer-checked:shadow-sm transition-all"
                  >Pessoa F√≠sica</span
                >
              </label>
              <label class="flex-1 text-center cursor-pointer">
                <input
                  type="radio"
                  name="tipoPessoa"
                  value="pj"
                  onchange="toggleDocInput()"
                  class="peer hidden"
                />
                <span
                  class="block py-2 rounded-lg text-sm font-bold text-slate-500 peer-checked:bg-white peer-checked:text-blue-600 peer-checked:shadow-sm transition-all"
                  >Jur√≠dica</span
                >
              </label>
            </div>

            <input
              type="tel"
              id="cpfInput"
              placeholder="Seu CPF"
              class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition"
            />
            <input
              type="tel"
              id="cnpjInput"
              placeholder="Seu CNPJ"
              class="hidden w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition"
            />

            <div class="relative">
              <select
                id="tipoUser"
                class="w-full p-3.5 bg-white border border-slate-200 rounded-xl appearance-none text-slate-600 font-bold focus:ring-2 focus:ring-blue-500 outline-none transition cursor-pointer"
              >
                <option value="fornecedor">
                  Sou Fornecedor (Quero Vender)
                </option>
                <option value="gerente">Sou Gerente (Quero Comprar)</option>
              </select>
              <i
                data-lucide="chevron-down"
                class="absolute right-4 top-4 text-slate-400 w-5 h-5 pointer-events-none"
              ></i>
            </div>

            <!-- Aceite dos Termos -->
            <div class="flex items-start gap-3 mt-2 px-1">
              <div class="flex items-center h-5">
                <input
                  type="checkbox"
                  id="terms-checkbox"
                  class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                />
              </div>
              <label
                for="terms-checkbox"
                class="text-xs text-slate-500 leading-tight"
              >
                Li e concordo com os
                <a
                  href="termos.html"
                  target="_blank"
                  class="text-blue-600 font-bold hover:underline"
                  >Termos</a
                >
                e
                <a
                  href="politica.html"
                  target="_blank"
                  class="text-blue-600 font-bold hover:underline"
                  >Pol√≠tica de Privacidade</a
                >.
              </label>
            </div>
          </div>

          <button
            id="btn-action"
            onclick="login()"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-xl font-bold text-lg shadow-lg shadow-blue-500/30 transition transform active:scale-95 flex justify-center items-center gap-2"
          >
            <span>Entrar</span>
            <i data-lucide="arrow-right" class="w-5 h-5"></i>
          </button>
        </div>

        <div class="text-center mt-8 pt-6 border-t border-slate-100">
          <p class="text-sm text-slate-500 mb-2" id="msg-toggle-text">
            N√£o tem conta?
          </p>
          <button
            onclick="toggleAuthMode()"
            id="msg-toggle"
            class="text-blue-600 font-bold hover:text-blue-800 transition text-sm uppercase tracking-wide"
          >
            Criar conta gr√°tis
          </button>
        </div>
      </div>
    </div>

    <!-- ======================================================= -->
    <!-- 3. SISTEMA PRINCIPAL (App) -->
    <!-- ======================================================= -->
    <div
      id="app-screen"
      class="hidden bg-slate-50 min-h-screen pb-24 fade-enter flex-col"
    >
      <!-- Header App (COM BOT√ÉO DE PERFIL) -->
      <header
        class="bg-white border-b border-slate-200 sticky top-0 z-30 shadow-sm/50"
      >
        <div
          class="container mx-auto px-4 py-3 flex justify-between items-center"
        >
          <div class="flex items-center gap-3">
            <div
              class="w-10 h-10 bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl flex items-center justify-center text-white shadow-lg shadow-blue-500/20"
            >
              <i data-lucide="layout-grid" class="w-5 h-5"></i>
            </div>
            <div>
              <h1 class="font-bold text-slate-800 leading-none text-lg">
                Painel
              </h1>
              <p
                id="user-display"
                class="text-[10px] text-slate-500 font-bold uppercase tracking-wider mt-1"
              >
                Carregando...
              </p>
            </div>
          </div>

          <!-- √ÅREA DE PERFIL E LOGOUT -->
          <div class="flex items-center gap-2">
            <!-- Bot√£o Perfil Adicionado -->
            <button
              onclick="window.location.href='perfil.html'"
              class="flex items-center gap-2 bg-slate-100 hover:bg-blue-50 text-slate-700 hover:text-blue-600 px-3 py-2 rounded-xl transition border border-transparent hover:border-blue-100"
            >
              <div
                class="w-6 h-6 bg-slate-200 rounded-full flex items-center justify-center text-slate-500 overflow-hidden"
              >
                <i data-lucide="user" class="w-4 h-4"></i>
              </div>
              <span class="text-xs font-bold hidden sm:block">Meu Perfil</span>
            </button>
            <button
              onclick="logout()"
              class="text-slate-400 hover:text-red-500 transition p-2.5 rounded-xl hover:bg-red-50"
              title="Sair"
            >
              <i data-lucide="log-out" class="w-5 h-5"></i>
            </button>
          </div>
        </div>
      </header>

      <main class="container mx-auto px-4 max-w-2xl mt-6 flex-grow">
        <!-- Alerta Index -->
        <div
          id="index-alert"
          class="hidden bg-yellow-50 border border-yellow-200 rounded-2xl p-4 mb-6 flex items-start gap-3 shadow-sm"
        >
          <div class="bg-yellow-100 p-2 rounded-full text-yellow-600 shrink-0">
            <i data-lucide="alert-triangle" class="w-5 h-5"></i>
          </div>
          <div class="text-sm text-yellow-800">
            <strong class="block mb-1">A√ß√£o Necess√°ria (Admin)</strong>
            Para que a aba "Minhas Ofertas" funcione, o Firebase precisa de um
            √≠ndice. Abra o console do navegador (F12) e clique no link de erro
            fornecido pelo Firebase.
          </div>
        </div>

        <!-- Filtros -->
        <div
          class="flex items-center justify-between mb-6 bg-white p-2 rounded-2xl border border-slate-200 shadow-sm sticky top-20 z-20"
        >
          <div class="flex items-center gap-2 text-slate-700 font-bold px-3">
            <i data-lucide="filter" class="w-4 h-4 text-blue-500"></i>
            <span class="text-sm">Filtrar</span>
          </div>
          <div class="relative">
            <select
              id="filtro-categoria"
              onchange="aplicarFiltro()"
              class="pl-3 pr-10 py-2 bg-slate-50 border border-slate-200 rounded-xl text-xs font-bold text-slate-600 focus:outline-none focus:border-blue-500 transition cursor-pointer hover:bg-slate-100"
            >
              <option value="todos">Todas Categorias</option>
              <option value="Alimentos">Alimentos</option>
              <option value="Bebidas">Bebidas</option>
              <option value="Limpeza">Limpeza</option>
              <option value="Hortifruti">Hortifruti</option>
              <option value="Outros">Outros</option>
            </select>
            <i
              data-lucide="chevron-down"
              class="absolute right-3 top-2.5 w-4 h-4 text-slate-400 pointer-events-none"
            ></i>
          </div>
        </div>

        <!-- VIEW GERENTE -->
        <div id="view-gerente" class="hidden space-y-6">
          <!-- Card de Cria√ß√£o -->
          <div
            class="bg-white p-6 rounded-3xl shadow-lg shadow-slate-200/50 border border-slate-100 relative overflow-hidden group hover:border-blue-200 transition-colors"
          >
            <div class="absolute top-0 left-0 w-1.5 h-full bg-blue-500"></div>
            <h2
              id="form-title"
              class="font-bold text-slate-800 mb-5 flex items-center gap-2 text-lg"
            >
              <div class="bg-blue-100 p-1.5 rounded-lg text-blue-600">
                <i data-lucide="plus" class="w-5 h-5"></i>
              </div>
              Novo Pedido
            </h2>
            <input type="hidden" id="edit-id" value="" />
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-5">
              <div class="sm:col-span-2">
                <label
                  class="text-[11px] uppercase font-bold text-slate-400 ml-1 mb-1 block tracking-wider"
                  >O que voc√™ precisa?</label
                >
                <input
                  type="text"
                  id="produtoInput"
                  placeholder="Ex: 10kg Arroz Tipo 1"
                  class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition font-medium"
                />
              </div>
              <div class="sm:col-span-1">
                <label
                  class="text-[11px] uppercase font-bold text-slate-400 ml-1 mb-1 block tracking-wider"
                  >Categoria</label
                >
                <div class="relative">
                  <select
                    id="categoriaInput"
                    class="w-full p-3.5 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 appearance-none font-medium text-slate-600"
                  >
                    <option value="Outros">Outros</option>
                    <option value="Alimentos">Aliment.</option>
                    <option value="Bebidas">Bebidas</option>
                    <option value="Limpeza">Limpeza</option>
                    <option value="Hortifruti">Hortifruti</option>
                  </select>
                  <i
                    data-lucide="chevron-down"
                    class="absolute right-3 top-4 w-4 h-4 text-slate-400 pointer-events-none"
                  ></i>
                </div>
              </div>
            </div>
            <div class="flex gap-3">
              <button
                id="btn-save-pedido"
                onclick="salvarPedido()"
                class="flex-1 bg-blue-600 text-white py-3.5 rounded-xl font-bold hover:bg-blue-700 transition shadow-lg shadow-blue-500/20 flex justify-center items-center gap-2 active:scale-95"
              >
                <i data-lucide="send" class="w-4 h-4"></i> Publicar Pedido
              </button>
              <button
                id="btn-cancel-edit"
                onclick="cancelarEdicao()"
                class="hidden px-5 py-3.5 bg-slate-100 text-slate-500 rounded-xl font-bold hover:bg-slate-200 transition"
              >
                Cancelar
              </button>
            </div>
          </div>

          <h3
            class="text-xs font-bold text-slate-400 uppercase tracking-widest pl-2 flex items-center gap-2"
          >
            <span class="w-1.5 h-1.5 rounded-full bg-slate-400"></span> Seus
            Pedidos Ativos
          </h3>
          <div id="lista-gerente" class="space-y-4 pb-10"></div>
        </div>

        <!-- VIEW FORNECEDOR -->
        <div id="view-fornecedor" class="hidden space-y-6">
          <!-- Abas -->
          <div
            class="flex p-1.5 bg-white border border-slate-200 rounded-2xl mb-6 shadow-sm"
          >
            <button
              onclick="mudarAbaForn('oportunidades')"
              id="tab-oportunidades"
              class="flex-1 py-3 rounded-xl text-sm font-bold bg-slate-100 text-slate-800 transition flex items-center justify-center gap-2"
            >
              <i data-lucide="search" class="w-4 h-4"></i> Oportunidades
            </button>
            <button
              onclick="mudarAbaForn('minhas')"
              id="tab-minhas"
              class="flex-1 py-3 rounded-xl text-sm font-bold text-slate-400 hover:text-slate-600 transition flex items-center justify-center gap-2"
            >
              <i data-lucide="list-checks" class="w-4 h-4"></i> Minhas Ofertas
            </button>
          </div>

          <div id="lista-fornecedor-todos" class="space-y-4 pb-10"></div>
          <div
            id="lista-fornecedor-minhas"
            class="hidden space-y-4 pb-10"
          ></div>
        </div>
      </main>
    </div>

    <!-- LOGICA E FIREBASE -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        addDoc,
        onSnapshot,
        query,
        orderBy,
        doc,
        setDoc,
        getDoc,
        updateDoc,
        deleteDoc,
        increment,
        serverTimestamp,
        collectionGroup,
        where,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
      import {
        getAuth,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        onAuthStateChanged,
        signOut,
        sendPasswordResetEmail,
      } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

      // CONFIGURA√á√ÉO DO FIREBASE (Coloque suas chaves aqui se necess√°rio, mas j√° est√£o no c√≥digo anterior)
      const firebaseConfig = {
        apiKey: "AIzaSyAhPYUnom0B7vXOjqf5eyMzye8f-Mp97Yw",
        authDomain: "leilaoreverso-af6e1.firebaseapp.com",
        projectId: "leilaoreverso-af6e1",
        storageBucket: "leilaoreverso-af6e1.firebasestorage.app",
        messagingSenderId: "1011226599836",
        appId: "1:1011226599836:web:e1f033e9ec9a1101896859",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);

      let currentUserData = null;
      let allPedidos = [];
      let myOffers = [];

      const initIcons = () => lucide.createIcons();
      window.addEventListener("load", initIcons);

      // --- CARREGAR DEPOIMENTOS NA LANDING PAGE ---
      async function carregarDepoimentos() {
        const container = document.getElementById("depoimentos-carousel");
        // Busca apenas aprovados
        const q = query(
          collection(db, "depoimentos"),
          where("status", "==", "aprovado"),
          orderBy("createdAt", "desc")
        );

        try {
          const querySnapshot = await getDocs(q);
          if (querySnapshot.empty) {
            container.innerHTML = `
                        <div class="min-w-full text-center py-10 px-4 bg-slate-50 rounded-3xl border border-slate-100 border-dashed">
                            <p class="text-slate-400 text-sm">Nenhum depoimento ainda. Seja o primeiro a avaliar!</p>
                        </div>`;
            return;
          }

          let depoimentosHTML = "";
          querySnapshot.forEach((doc) => {
            const d = doc.data();
            const iniciais = d.usuarioNome
              ? d.usuarioNome.substring(0, 2).toUpperCase()
              : "AN";
            depoimentosHTML += `
                        <div class="min-w-[280px] md:min-w-[350px] bg-white p-6 rounded-3xl shadow-sm border border-slate-100 flex-shrink-0 snap-center hover:shadow-md transition">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center text-white font-bold text-sm shadow-md shadow-blue-500/20">
                                    ${iniciais}
                                </div>
                                <div>
                                    <div class="font-bold text-slate-800 text-sm">${
                                      d.usuarioNome
                                    }</div>
                                    <div class="text-xs text-blue-600 font-medium bg-blue-50 px-2 py-0.5 rounded-full w-fit">${
                                      d.tipoUsuario === "gerente"
                                        ? "Gerente"
                                        : "Fornecedor"
                                    }</div>
                                </div>
                            </div>
                            <div class="relative">
                                <i data-lucide="quote" class="w-6 h-6 text-slate-200 absolute -top-2 -left-2 transform -scale-x-100"></i>
                                <p class="text-slate-600 text-sm italic leading-relaxed pl-4 relative z-10">"${
                                  d.texto
                                }"</p>
                            </div>
                        </div>
                    `;
          });
          container.innerHTML = depoimentosHTML;
          initIcons();
        } catch (error) {
          console.warn("Depoimentos:", error); // Silent fail no UI
        }
      }

      // --- REAL-TIME ACTIVITY FEED (LANDING PAGE) ---
      function setupActivityFeedListener() {
        const activityQueue = [];
        let isProcessing = false;

        const q = query(
          collection(db, "public_activity_feed"),
          orderBy("timestamp", "desc"),
          where("timestamp", ">", new Date())
        );

        onSnapshot(q, (snapshot) => {
          snapshot.docChanges().forEach((change) => {
            if (change.type === "added") {
              activityQueue.push(change.doc.data());
              if (!isProcessing) {
                processQueue();
              }
            }
          });
        });

        function processQueue() {
          if (activityQueue.length === 0) {
            isProcessing = false;
            return;
          }

          isProcessing = true;
          const activity = activityQueue.shift();
          displayActivityToast(activity);

          setTimeout(processQueue, 5000);
        }

        function displayActivityToast(activity) {
          const container = document.getElementById("activity-feed-container");
          if (!container) return;

          const icons = {
            new_pedido:
              '<i data-lucide="file-plus-2" class="w-5 h-5 text-blue-400"></i>',
            new_oferta:
              '<i data-lucide="dollar-sign" class="w-5 h-5 text-green-400"></i>',
            deal_closed:
              '<i data-lucide="handshake" class="w-5 h-5 text-amber-400"></i>',
          };

          const toast = document.createElement("div");
          toast.className = "activity-toast";
          toast.innerHTML = `${
            icons[activity.type] || ""
          } <span class="text-sm font-medium">${activity.message}</span>`;

          container.appendChild(toast);
          lucide.createIcons();
          setTimeout(() => toast.remove(), 5000);
        }
      }

      // --- PWA INSTALL ---
      let deferredPrompt;
      const btnInstall = document.getElementById("btn-install-app");
      window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault();
        deferredPrompt = e;
        btnInstall.classList.remove("hidden");
      });
      btnInstall.addEventListener("click", async () => {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          if (outcome === "accepted") btnInstall.classList.add("hidden");
          deferredPrompt = null;
        }
      });
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("./sw.js")
          .then((reg) => {
            reg.onupdatefound = () => {
              const installingWorker = reg.installing;
              installingWorker.onstatechange = () => {
                if (
                  installingWorker.state === "installed" &&
                  navigator.serviceWorker.controller
                ) {
                  window.location.reload();
                }
              };
            };
          })
          .catch(console.log);
      }

      // --- UI ---
      window.toggleDocInput = () => {
        const isPf =
          document.querySelector('input[name="tipoPessoa"]:checked').value ===
          "pf";
        const cpfInput = document.getElementById("cpfInput");
        const cnpjInput = document.getElementById("cnpjInput");
        if (isPf) {
          cpfInput.classList.remove("hidden");
          cnpjInput.classList.add("hidden");
        } else {
          cpfInput.classList.add("hidden");
          cnpjInput.classList.remove("hidden");
        }
      };
      window.mostrarLogin = () => {
        document.getElementById("landing-screen").classList.add("hidden");
        document.getElementById("auth-screen").classList.remove("hidden");
        btnInstall.classList.add("hidden");
      };
      window.voltarInicio = () => {
        document.getElementById("auth-screen").classList.add("hidden");
        document.getElementById("landing-screen").classList.remove("hidden");
        if (deferredPrompt) btnInstall.classList.remove("hidden");
      };

      // --- AUTH ---
      let isLoginMode = true;
      window.toggleAuthMode = () => {
        isLoginMode = !isLoginMode;
        const fields = document.getElementById("signup-fields");
        const btn = document.getElementById("btn-action");
        const msgText = document.getElementById("msg-toggle-text");
        const msgBtn = document.getElementById("msg-toggle");
        const forgotPassLink = document.getElementById("forgot-password-link");
        if (!isLoginMode) {
          fields.classList.remove("hidden");
          btn.innerHTML = `<span>Criar Conta</span> <i data-lucide="arrow-right" class="w-5 h-5"></i>`;
          btn.onclick = cadastrar;
          msgText.innerText = "J√° tem uma conta?";
          msgBtn.innerText = "Fazer Login";
          forgotPassLink.classList.add("hidden");
        } else {
          fields.classList.add("hidden");
          btn.innerHTML = `<span>Entrar</span> <i data-lucide="arrow-right" class="w-5 h-5"></i>`;
          btn.onclick = login;
          msgText.innerText = "N√£o tem conta?";
          msgBtn.innerText = "Criar conta gr√°tis";
          forgotPassLink.classList.remove("hidden");
        }
        initIcons();
      };

      window.cadastrar = async () => {
        const email = document.getElementById("email").value;
        const pass = document.getElementById("password").value;
        const nome = document.getElementById("nome").value;
        const tipo = document.getElementById("tipoUser").value;
        let zap = document.getElementById("whatsapp").value.replace(/\D/g, "");
        if (zap.length >= 10 && !zap.startsWith("55")) zap = "55" + zap;

        const tipoPessoa = document.querySelector(
          'input[name="tipoPessoa"]:checked'
        ).value;
        let docNum =
          tipoPessoa === "pf"
            ? document.getElementById("cpfInput").value.replace(/\D/g, "")
            : document.getElementById("cnpjInput").value.replace(/\D/g, "");

        if (!email || !pass || !nome || !zap || !docNum)
          return alert("Preencha todos os campos!");
        if (!document.getElementById("terms-checkbox").checked)
          return alert("Aceite os termos para continuar.");

        const btn = document.getElementById("btn-action");
        btn.innerText = "Criando...";
        btn.disabled = true;

        try {
          const cred = await createUserWithEmailAndPassword(auth, email, pass);
          await setDoc(doc(db, "users", cred.user.uid), {
            nome,
            tipo,
            whatsapp: zap,
            email,
            tipoPessoa,
            createdAt: serverTimestamp(),
            documento: docNum,
          });
        } catch (e) {
          alert("Erro: " + e.message);
          btn.innerText = "Tentar Novamente";
          btn.disabled = false;
        }
      };

      window.login = async () => {
        const btn = document.getElementById("btn-action");
        btn.innerText = "Entrando...";
        btn.disabled = true;
        try {
          await signInWithEmailAndPassword(
            auth,
            document.getElementById("email").value,
            document.getElementById("password").value
          );
        } catch (e) {
          alert("Login inv√°lido.");
          btn.innerText = "Entrar";
          btn.disabled = false;
        }
      };
      window.logout = () => signOut(auth);

      window.resetPassword = async () => {
        const email = document.getElementById("email").value;
        if (!email) {
          return alert(
            "Por favor, digite seu e-mail no campo correspondente para redefinir a senha."
          );
        }
        try {
          await sendPasswordResetEmail(auth, email);
          alert(
            "Um link para redefini√ß√£o de senha foi enviado para o seu e-mail. Verifique sua caixa de entrada e spam."
          );
        } catch (error) {
          console.error("Erro ao enviar e-mail de redefini√ß√£o:", error);
          alert(
            "Ocorreu um erro. Verifique se o e-mail est√° correto e tente novamente."
          );
        }
      };

      // --- STATE MANAGER ---
      onAuthStateChanged(auth, async (user) => {
        if (user) {
          document.getElementById("landing-screen").classList.add("hidden");
          document.getElementById("auth-screen").classList.add("hidden");
          document.getElementById("app-screen").classList.remove("hidden");
          // O bot√£o de instalar √© mostrado/oculto pelo evento 'beforeinstallprompt'
          btnInstall.classList.add("hidden");
          const userDoc = await getDoc(doc(db, "users", user.uid));
          if (userDoc.exists()) {
            currentUserData = userDoc.data();
            currentUserData.uid = user.uid;
            document.getElementById("user-display").innerText = `${
              currentUserData.nome
            } ‚Ä¢ ${currentUserData.tipo === "gerente" ? "LOJA" : "FORNECEDOR"}`;
            iniciarApp(currentUserData.tipo);
          }
        } else {
          document.getElementById("app-screen").classList.add("hidden");
          document.getElementById("auth-screen").classList.add("hidden");
          document.getElementById("landing-screen").classList.remove("hidden");
          if (deferredPrompt) btnInstall.classList.remove("hidden");
          carregarDepoimentos();
          currentUserData = null;
        }
      });

      // Inicia o listener do feed de atividades da landing page
      setupActivityFeedListener();

      // --- CORE APP & RENDERS ---
      function iniciarApp(tipo) {
        const pedidosRef = collection(db, "pedidos");
        const q = query(pedidosRef, orderBy("createdAt", "desc"));
        document.getElementById("view-gerente").classList.add("hidden");
        document.getElementById("view-fornecedor").classList.add("hidden");

        onSnapshot(q, (snapshot) => {
          allPedidos = [];
          snapshot.forEach((doc) =>
            // Adiciona o status 'aberto' se n√£o existir, para compatibilidade
            allPedidos.push({ id: doc.id, ...doc.data() })
          );
          if (tipo === "gerente") renderGerente();
          else renderFornecedorOportunidades();
        });

        if (tipo === "gerente") {
          document.getElementById("view-gerente").classList.remove("hidden");
        } else {
          document.getElementById("view-fornecedor").classList.remove("hidden");
          const myOffersQ = query(
            collectionGroup(db, "ofertas"),
            where("fornecedorId", "==", currentUserData.uid)
          );
          onSnapshot(
            myOffersQ,
            (snap) => {
              myOffers = [];
              snap.forEach((d) =>
                myOffers.push({ id: d.id, path: d.ref.path, ...d.data() })
              );
              renderFornecedorMinhas();
              renderFornecedorOportunidades();
            },
            (error) => {
              if (error.code === "failed-precondition")
                document
                  .getElementById("index-alert")
                  .classList.remove("hidden");
            }
          );
        }
      }

      window.aplicarFiltro = () => {
        if (currentUserData.tipo === "gerente") renderGerente();
        else renderFornecedorOportunidades();
      };
      function filtrarDados(lista) {
        const categ = document.getElementById("filtro-categoria").value;
        return categ === "todos"
          ? lista
          : lista.filter((item) => item.categoria === categ);
      }

      function renderGerente() {
        const container = document.getElementById("lista-gerente");
        container.innerHTML = "";
        const filtrados = filtrarDados(allPedidos);
        if (filtrados.length === 0) {
          container.innerHTML = `<div class="text-center text-slate-400 py-12 flex flex-col items-center"><div class="bg-slate-100 p-4 rounded-full mb-3"><i data-lucide="clipboard-list" class="w-8 h-8 opacity-50"></i></div><p>Nenhum pedido encontrado.</p></div>`;
          initIcons();
          return;
        }
        filtrados.forEach((data) => {
          if (data.status === "fechado") {
            // CARD DE PEDIDO FECHADO
            container.innerHTML += `
                      <div class="bg-green-50 p-5 rounded-3xl shadow-sm border border-green-200 relative group">
                          <div class="absolute top-5 right-5">
                              <span class="bg-green-100 text-green-800 text-xs font-bold px-3 py-1.5 rounded-full flex items-center gap-2"><i data-lucide="check-circle" class="w-4 h-4"></i> Fechado</span>
                          </div>
                          <div class="flex items-center gap-3 mb-3 pr-24">
                              <span class="bg-green-100 text-green-800 text-[10px] font-bold px-2.5 py-1 rounded-lg uppercase border border-green-200 tracking-wider">${
                                data.categoria || "Geral"
                              }</span>
                              <h4 class="font-bold text-slate-800 text-lg leading-tight">${
                                data.produto
                              }</h4>
                          </div>
                          <div class="mt-4 bg-white/70 p-4 rounded-2xl border border-green-200">
                              <div class="text-xs text-slate-500 font-bold mb-2">OFERTA VENCEDORA:</div>
                              <div class="flex justify-between items-center">
                                  <div>
                                      <div class="font-bold text-green-600 text-xl tracking-tight">R$ ${data.valorVencedor.toFixed(
                                        2
                                      )}</div>
                                      <div class="text-xs text-slate-500 font-bold uppercase tracking-wider flex items-center gap-1 mt-1"><i data-lucide="store" class="w-3 h-3"></i> ${
                                        data.fornecedorVencedorNome
                                      }</div>
                                  </div>
                                  <a href="https://wa.me/${
                                    data.fornecedorVencedorWhatsapp
                                  }?text=Ol√° ${
              data.fornecedorVencedorNome
            }, sobre a sua oferta de R$${
              data.valorVencedor
            }..." target="_blank" class="bg-green-500 text-white px-4 py-2.5 rounded-xl hover:bg-green-600 transition shadow-lg shadow-green-500/30 font-bold text-sm flex items-center gap-2"><i data-lucide="message-circle" class="w-4 h-4"></i> Chamar</a>
                              </div>
                          </div>
                      </div>`;
          } else {
            // CARD DE PEDIDO ABERTO
            container.innerHTML += `
                      <div class="bg-white p-5 rounded-3xl shadow-sm border border-slate-100 hover:shadow-md transition relative group">
                          <div class="absolute top-5 right-5 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                              <button onclick="editarPedido('${data.id}', '${
              data.produto
            }', '${
              data.categoria || "Outros"
            }')" class="p-2 bg-blue-50 text-blue-600 rounded-xl hover:bg-blue-100 transition"><i data-lucide="pencil" class="w-4 h-4"></i></button>
                              <button onclick="apagarPedido('${
                                data.id
                              }')" class="p-2 bg-red-50 text-red-500 rounded-xl hover:bg-red-100 transition"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                          </div>
                          <div class="flex items-center gap-3 mb-3 pr-16">
                              <span class="bg-blue-50 text-blue-700 text-[10px] font-bold px-2.5 py-1 rounded-lg uppercase border border-blue-100 tracking-wider">${
                                data.categoria || "Geral"
                              }</span>
                              <h4 class="font-bold text-slate-800 text-lg leading-tight">${
                                data.produto
                              }</h4>
                          </div>
                          <div class="flex items-center justify-between mt-4">
                              <span class="text-xs font-bold text-slate-500 bg-slate-50 px-3 py-1.5 rounded-full border border-slate-200 flex items-center gap-1.5"><i data-lucide="users" class="w-3.5 h-3.5 text-slate-400"></i> ${
                                data.ofertasCount || 0
                              } ofertas</span>
                              <button onclick="verOfertas('${
                                data.id
                              }')" id="btn-ver-${
              data.id
            }" class="text-sm font-bold text-blue-600 hover:text-blue-800 flex items-center gap-1 transition bg-blue-50 px-4 py-2 rounded-xl hover:bg-blue-100">Ver Ofertas <i data-lucide="chevron-down" class="w-4 h-4"></i></button>
                          </div>
                          <div id="ofertas-${
                            data.id
                          }" class="hidden mt-4 space-y-2 bg-slate-50 p-4 rounded-2xl border border-slate-200"></div>
                      </div>`;
          }
        });
        initIcons();
      }

      function renderFornecedorOportunidades() {
        const container = document.getElementById("lista-fornecedor-todos");
        container.innerHTML = "";
        const filtrados = filtrarDados(allPedidos);
        if (filtrados.length === 0) {
          container.innerHTML =
            '<div class="text-center text-slate-400 mt-12">Nenhuma oportunidade dispon√≠vel no momento.</div>';
          return;
        }
        filtrados.forEach((data) => {
          const ofertaJaFeita = myOffers.find((o) => o.path.includes(data.id));
          if (ofertaJaFeita) {
            container.innerHTML += `
                        <div class="bg-emerald-50 p-6 rounded-3xl shadow-sm border border-emerald-100/50 relative overflow-hidden">
                            <div class="flex justify-between items-start mb-3 relative z-10">
                                <div>
                                    <span class="bg-emerald-200/50 text-emerald-800 text-[10px] px-2 py-1 rounded-lg font-bold uppercase tracking-wide inline-flex items-center gap-1 mb-1"><i data-lucide="check-circle-2" class="w-3 h-3"></i> Enviado</span>
                                    <h4 class="font-bold text-emerald-900/60 text-lg line-through decoration-emerald-300 decoration-2">${
                                      data.produto
                                    }</h4>
                                </div>
                            </div>
                            <div class="text-sm text-emerald-700 font-bold flex items-center gap-2 mt-2 bg-emerald-100/50 p-3 rounded-xl w-fit">
                                Sua oferta: <span class="text-lg">R$ ${ofertaJaFeita.valor.toFixed(
                                  2
                                )}</span>
                            </div>
                        </div>`;
          } else {
            container.innerHTML += `
                        <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 hover:shadow-lg hover:border-blue-100 transition duration-300">
                            <div class="flex justify-between items-start mb-5">
                                <div>
                                    <span class="text-[10px] font-bold uppercase bg-slate-100 text-slate-500 px-2 py-1 rounded-lg tracking-wider mb-1 inline-block">${
                                      data.categoria || "Geral"
                                    }</span>
                                    <h4 class="font-bold text-slate-800 text-xl">${
                                      data.produto
                                    }</h4>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <div class="relative flex-1 group">
                                    <span class="absolute left-4 top-3.5 text-slate-400 text-sm font-bold group-focus-within:text-blue-500 transition-colors">R$</span>
                                    <input type="number" id="valor-${
                                      data.id
                                    }" class="w-full pl-10 p-3.5 border border-slate-200 rounded-xl text-lg outline-none focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 font-bold text-slate-700 transition placeholder:text-slate-300" placeholder="0,00">
                                </div>
                                <button onclick="enviarOferta('${
                                  data.id
                                }')" class="bg-blue-600 text-white px-6 rounded-xl font-bold shadow-lg shadow-blue-500/20 hover:bg-blue-700 hover:shadow-blue-600/30 transition active:scale-95 flex items-center justify-center">
                                    <i data-lucide="send" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </div>`;
          }
        });
        initIcons();
      }

      // ... [Resto das fun√ß√µes CRUD e auxiliares permanecem iguais] ...
      // Mantive as fun√ß√µes salvarPedido, editarPedido, verOfertas, etc.
      // Apenas para garantir que o c√≥digo caiba na resposta e funcione, vou incluir as essenciais de l√≥gica

      function renderFornecedorMinhas() {
        const container = document.getElementById("lista-fornecedor-minhas");
        container.innerHTML = "";
        if (myOffers.length === 0) {
          container.innerHTML =
            '<div class="text-center text-slate-400 mt-12">Voc√™ ainda n√£o fez ofertas.</div>';
          return;
        }
        myOffers.forEach((offer) => {
          const pedidoId = offer.path.split("/")[1];
          const produtoRelacionado = allPedidos.find((p) => p.id === pedidoId);

          if (!produtoRelacionado) return; // Pula se o pedido foi deletado

          const nomeProduto = produtoRelacionado.produto;
          let statusBadge = "";
          if (produtoRelacionado.status === "fechado") {
            if (produtoRelacionado.ofertaVencedoraId === offer.id) {
              statusBadge =
                '<span class="bg-green-100 text-green-800 text-xs font-bold px-3 py-1 rounded-full flex items-center gap-2"><i data-lucide="trophy" class="w-4 h-4"></i> Vencedor</span>';
            } else {
              statusBadge =
                '<span class="bg-slate-100 text-slate-500 text-xs font-bold px-3 py-1 rounded-full">Encerrado</span>';
            }
          }

          let cardHTML = `
                    <div class="bg-white p-5 rounded-3xl shadow-sm border border-slate-100 mb-3 flex justify-between items-center group hover:border-blue-100 transition">
                        <div>
                            <div class="text-[10px] font-bold text-slate-400 uppercase tracking-wide mb-1">Oferta para:</div>
                            <div class="font-bold text-slate-700 text-lg mb-1">${nomeProduto}</div>
                            <div class="font-bold text-green-600 text-xl flex items-center gap-1">R$ <input type="number" id="edit-val-${
                              offer.id
                            }" value="${
            offer.valor
          }" class="w-28 border-b-2 border-dashed border-green-200 focus:outline-none focus:border-green-500 bg-transparent text-green-700 py-1"></div>
                        </div>
                        <div class="flex gap-2">
                            ${
                              statusBadge
                                ? statusBadge
                                : `
                                <button onclick="atualizarMinhaOferta('${offer.path}', '${offer.id}')" class="w-10 h-10 bg-blue-50 text-blue-600 rounded-xl hover:bg-blue-100 transition flex items-center justify-center"><i data-lucide="save" class="w-5 h-5"></i></button>
                                <button onclick="apagarMinhaOferta('${offer.path}', '${pedidoId}')" class="w-10 h-10 bg-red-50 text-red-500 rounded-xl hover:bg-red-100 transition flex items-center justify-center"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
                            `
                            }
                        </div>
                    </div>`;

          container.innerHTML += cardHTML;
        });

        initIcons();
      }

      // Inicia o listener do feed de atividades da landing page
      setupActivityFeedListener();

      window.salvarPedido = async () => {
        const inp = document.getElementById("produtoInput");
        const cat = document.getElementById("categoriaInput");
        const editId = document.getElementById("edit-id").value;
        const btn = document.getElementById("btn-save-pedido");
        if (!inp.value) return alert("Digite o nome do produto");
        btn.disabled = true;
        btn.innerHTML =
          '<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> Salvando...';
        initIcons();
        try {
          if (editId) {
            await updateDoc(doc(db, "pedidos", editId), {
              produto: inp.value,
              categoria: cat.value,
            });
            alert("Atualizado!");
            cancelarEdicao();
          } else {
            await addDoc(collection(db, "pedidos"), {
              produto: inp.value,
              categoria: cat.value,
              createdAt: serverTimestamp(),
              criadoPor: currentUserData.uid,
              status: "aberto",
              ofertasCount: 0,
            });
            // Adiciona ao feed de atividades p√∫blicas
            await addDoc(collection(db, "public_activity_feed"), {
              type: "new_pedido",
              message: `Nova cota√ß√£o para "${inp.value.substring(0, 20)}..."`,
              timestamp: serverTimestamp(),
            });
          }
          inp.value = "";
        } catch (e) {
          console.error(e);
          alert("Erro ao salvar.");
        } finally {
          btn.disabled = false;
          btn.innerHTML =
            '<i data-lucide="send" class="w-4 h-4"></i> Publicar Pedido';
          initIcons();
        }
      };
      window.editarPedido = (id, prod, cat) => {
        document.getElementById("produtoInput").value = prod;
        document.getElementById("categoriaInput").value = cat;
        document.getElementById("edit-id").value = id;
        document.getElementById("form-title").innerHTML =
          '<div class="bg-orange-100 p-1.5 rounded-lg text-orange-600"><i data-lucide="pencil" class="w-5 h-5"></i></div> Editando Pedido';
        const btn = document.getElementById("btn-save-pedido");
        btn.innerText = "Salvar Altera√ß√µes";
        btn.className =
          "flex-1 bg-orange-500 text-white py-3.5 rounded-xl font-bold hover:bg-orange-600 transition shadow-lg shadow-orange-500/20 flex justify-center items-center gap-2";
        document.getElementById("btn-cancel-edit").classList.remove("hidden");
        window.scrollTo({ top: 0, behavior: "smooth" });
        initIcons();
      };
      window.cancelarEdicao = () => {
        document.getElementById("produtoInput").value = "";
        document.getElementById("edit-id").value = "";
        document.getElementById("categoriaInput").value = "Outros";
        document.getElementById("form-title").innerHTML =
          '<div class="bg-blue-100 p-1.5 rounded-lg text-blue-600"><i data-lucide="plus" class="w-5 h-5"></i></div> Novo Pedido';
        const btn = document.getElementById("btn-save-pedido");
        btn.innerHTML =
          '<i data-lucide="send" class="w-4 h-4"></i> Publicar Pedido';
        btn.className =
          "flex-1 bg-blue-600 text-white py-3.5 rounded-xl font-bold hover:bg-blue-700 transition shadow-lg shadow-blue-500/20 flex justify-center items-center gap-2";
        document.getElementById("btn-cancel-edit").classList.add("hidden");
        initIcons();
      };
      window.apagarPedido = async (id) => {
        if (confirm("Tem certeza?")) await deleteDoc(doc(db, "pedidos", id));
      };
      window.verOfertas = (id) => {
        const div = document.getElementById(`ofertas-${id}`);
        const btn = document.getElementById(`btn-ver-${id}`);
        if (!div.classList.contains("hidden")) {
          div.classList.add("hidden");
          btn.innerHTML = `Ver Ofertas <i data-lucide="chevron-down" class="w-4 h-4"></i>`;
          initIcons();
          return;
        }
        div.classList.remove("hidden");
        btn.innerHTML = `Ocultar <i data-lucide="chevron-up" class="w-4 h-4"></i>`;
        div.innerHTML =
          '<div class="flex justify-center py-4"><i data-lucide="loader-2" class="w-6 h-6 animate-spin text-blue-500"></i></div>';
        initIcons();
        const q = query(
          collection(db, "pedidos", id, "ofertas"),
          orderBy("valor", "asc")
        );
        onSnapshot(q, (snap) => {
          div.innerHTML = "";
          if (snap.empty) {
            div.innerHTML =
              '<p class="text-xs text-slate-400 text-center py-2">Nenhuma oferta recebida.</p>';
            return;
          }
          snap.forEach((o) => {
            const off = o.data();
            div.innerHTML += `
                      <div class="flex justify-between items-center bg-white p-4 rounded-xl shadow-sm border border-slate-100 mb-2">
                          <div>
                              <div class="font-bold text-green-600 text-xl tracking-tight">R$ ${off.valor.toFixed(
                                2
                              )}</div>
                              <div class="text-[10px] text-slate-400 font-bold uppercase tracking-wider flex items-center gap-1 mt-1">
                                  <i data-lucide="store" class="w-3 h-3"></i> ${
                                    off.fornecedorNome
                                  }
                              </div>
                          </div>
                          <div class="flex items-center gap-2">
                              <button onclick="marcarVencedor('${id}', '${
              o.id
            }', '${off.fornecedorId}', '${off.fornecedorNome}', ${
              off.valor
            }, '${
              off.whatsapp
            }')" class="bg-amber-400 text-amber-900 px-3 py-2.5 rounded-xl hover:bg-amber-500 transition shadow-lg shadow-amber-500/20 font-bold text-sm flex items-center gap-2" title="Marcar como vencedor">
                                  <i data-lucide="trophy" class="w-4 h-4"></i>
                              </button>
                              <a href="https://wa.me/${off.whatsapp}?text=Ol√° ${
              off.fornecedorNome
            }, sobre a sua oferta de R$${
              off.valor
            }..." target="_blank" class="bg-green-500 text-white px-4 py-2.5 rounded-xl hover:bg-green-600 transition shadow-lg shadow-green-500/30 font-bold text-sm flex items-center gap-2">
                                  <i data-lucide="message-circle" class="w-4 h-4"></i>
                                  <span class="hidden sm:inline">Chamar</span>
                              </a>
                          </div>
                      </div>`;
          });
          initIcons();
        });
      };
      window.marcarVencedor = async (
        pedidoId,
        ofertaId,
        fornecedorId,
        fornecedorNome,
        valor,
        whatsapp
      ) => {
        if (
          !confirm(
            `Marcar a oferta de ${fornecedorNome} (R$ ${valor}) como vencedora? Esta a√ß√£o n√£o pode ser desfeita.`
          )
        )
          return;

        const pedidoRef = doc(db, "pedidos", pedidoId);
        await updateDoc(pedidoRef, {
          status: "fechado",
          ofertaVencedoraId: ofertaId,
          fornecedorVencedorId: fornecedorId,
          fornecedorVencedorNome: fornecedorNome,
          fornecedorVencedorWhatsapp: whatsapp,
          valorVencedor: valor,
          fechadoEm: serverTimestamp(),
        });

        // Adiciona ao feed de atividades p√∫blicas
        await addDoc(collection(db, "public_activity_feed"), {
          type: "deal_closed",
          message: `Neg√≥cio fechado com ${fornecedorNome}!`,
          timestamp: serverTimestamp(),
        });
        alert("Neg√≥cio fechado com sucesso!");
      };
      window.mudarAbaForn = (aba) => {
        const btnOp = document.getElementById("tab-oportunidades");
        const btnMy = document.getElementById("tab-minhas");
        const lTodos = document.getElementById("lista-fornecedor-todos");
        const lMinhas = document.getElementById("lista-fornecedor-minhas");
        if (aba === "oportunidades") {
          lTodos.classList.remove("hidden");
          lMinhas.classList.add("hidden");
          btnOp.className =
            "flex-1 py-3 rounded-xl text-sm font-bold bg-slate-100 text-slate-800 transition flex items-center justify-center gap-2 shadow-sm";
          btnMy.className =
            "flex-1 py-3 rounded-xl text-sm font-bold text-slate-400 hover:text-slate-600 transition flex items-center justify-center gap-2";
        } else {
          lTodos.classList.add("hidden");
          lMinhas.classList.remove("hidden");
          btnMy.className =
            "flex-1 py-3 rounded-xl text-sm font-bold bg-slate-100 text-slate-800 transition flex items-center justify-center gap-2 shadow-sm";
          btnOp.className =
            "flex-1 py-3 rounded-xl text-sm font-bold text-slate-400 hover:text-slate-600 transition flex items-center justify-center gap-2";
        }
        initIcons();
      };
      window.enviarOferta = async (pedidoId) => {
        const val = document.getElementById(`valor-${pedidoId}`).value;
        if (!val) return;
        try {
          await addDoc(collection(db, "pedidos", pedidoId, "ofertas"), {
            valor: parseFloat(val),
            fornecedorId: currentUserData.uid,
            fornecedorNome: currentUserData.nome,
            whatsapp: currentUserData.whatsapp,
            createdAt: serverTimestamp(),
          });
          await updateDoc(doc(db, "pedidos", pedidoId), {
            ofertasCount: increment(1),
          });
          // Adiciona ao feed de atividades p√∫blicas
          await addDoc(collection(db, "public_activity_feed"), {
            type: "new_oferta",
            message: `Nova oferta recebida!`,
            timestamp: serverTimestamp(),
          });
          alert("Oferta enviada com sucesso!");
        } catch (e) {
          console.error(e);
          alert("Erro ao enviar.");
        }
      };
      window.atualizarMinhaOferta = async (path, elementId) => {
        const novoValor = document.getElementById(
          `edit-val-${elementId}`
        ).value;
        const parts = path.split("/");
        try {
          await updateDoc(doc(db, parts[0], parts[1], parts[2], parts[3]), {
            valor: parseFloat(novoValor),
          });
          alert("Pre√ßo atualizado!");
        } catch (e) {
          alert("Erro ao atualizar.");
        }
      };
      window.apagarMinhaOferta = async (path, parentId) => {
        if (!confirm("Remover esta oferta?")) return;
        const parts = path.split("/");
        try {
          await updateDoc(doc(db, "pedidos", parentId), {
            ofertasCount: increment(-1),
          });
          await deleteDoc(doc(db, parts[0], parts[1], parts[2], parts[3]));
        } catch (e) {
          alert("Erro ao apagar.");
        }
      };

      window.salvarPedido = salvarPedido;
      window.editarPedido = editarPedido;
      window.cancelarEdicao = cancelarEdicao;
      window.apagarPedido = apagarPedido;
      window.verOfertas = verOfertas;
      window.marcarVencedor = marcarVencedor;
      window.mudarAbaForn = mudarAbaForn;
      window.enviarOferta = enviarOferta;
      window.atualizarMinhaOferta = atualizarMinhaOferta;
      window.apagarMinhaOferta = apagarMinhaOferta;
      window.resetPassword = resetPassword;
    </script>
  </body>
</html>
